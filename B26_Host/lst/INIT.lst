C51 COMPILER V9.59.0.0   INIT                                                              04/27/2019 08:30:02 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE INIT
OBJECT MODULE PLACED IN .\obj\INIT.obj
COMPILER INVOKED BY: E:\MDK\C51\BIN\C51.EXE C\INIT.C OPTIMIZE(2,SPEED) BROWSE INCDIR(.\H;.\lib) DEBUG OBJECTEXTEND PRINT
                    -(.\lst\INIT.lst) TABS(7) OBJECT(.\obj\INIT.obj)

line level    source

   1          #include "INIT.H"
   2          #include "SC92F836xB_C.H"
   3          #include "bsp_io_data.h"
   4          #include "TimeOut.h"
   5          
   6          unsigned char count_250us_time,count_level,lock = 1;
   7          unsigned int   count_1ms_time;
   8          extern unsigned int motro_count0,
   9                                      motro_count1,
  10                                      auto_close_heat_cnt,
  11                                      auto_close_mass_cnt,
  12                                      u16TimeLock;
  13          
  14          extern unsigned char TX_DATA;
  15          
  16          extern unsigned char up_flag,
  17                                        down_flag,
  18                                        auto_close_heat,
  19                                        auto_close_mass;
  20          
  21          extern unsigned long MyKey_Buf_Data;
  22          
  23          
  24          
  25          void GPIO_INIT(void)
  26          {
  27   1        P0CON |= 7 << 0;                    //设置P00,P01,P02为强推挽IO
  28   1        P2CON |= 1 << 5;                 //设置P25为强推挽IO
  29   1      
  30   1        IO_LED_FOOT_LIGHT_OFF;         //脚灯关闭
  31   1        IO_RED_LIGHT_OFF;           //红灯关闭
  32   1        IO_MOTOR_ONE_OFF;                 //升降马达1关闭
  33   1        IO_MOTOR_TWO_OFF;                 //升降马达2关闭
  34   1      }
  35          
  36          void Timer0_Init(void)
  37          { 
  38   1      
  39   1             TMCON = 0X07;    //------111 ;Timer0、Tiemr1和Tiemr2选择时钟Fsys
  40   1             
  41   1             //T0设置
  42   1             TMOD |= 0x01;                 //0000 0001;Timer0设置工作方式1
  43   1             TL0 = (65536 - 350)%256;    //溢出时间：时钟为Fsys，则24000*（1/Fsys）=2ms;
  44   1             TH0 = (65536 - 350)/256;
  45   1             TR0 = 0;
  46   1             ET0 = 1;//定时器0允许
  47   1             TR0 = 1;//打开定时器0
  48   1      }
  49          
  50          #if 1
  51          void timer0() interrupt 1         //2MS
  52          {
  53   1          TL0 = (65536 - 350)%256;     //1090      2080
  54   1          TH0 = (65536 - 350)/256;     //100us     2080
C51 COMPILER V9.59.0.0   INIT                                                              04/27/2019 08:30:02 PAGE 2   

  55   1          #if 1
  56   1          TimeOutDet_DecHandle();
  57   1              count_250us_time++;
  58   1              if(count_250us_time > 100)
  59   1              {
  60   2                count_250us_time = 0;
  61   2              }
  62   1              if(count_250us_time >= count_level)
  63   1              {
  64   2                IO_LED_FOOT_LIGHT_OFF;
  65   2              }
  66   1              else
  67   1              {
  68   2                IO_LED_FOOT_LIGHT_ON;
  69   2              }     
  70   1              /*****************************锁键定时器************************/
  71   1           if((0X4000 == MyKey_Buf_Data)&&(1 == lock))
  72   1              {
  73   2                MyKey_Buf_Data = 0x1111;
  74   2                if(u16TimeLock < 1000)
  75   2                {
  76   3                   u16TimeLock++;
  77   3                }
  78   2                else
  79   2                {
  80   3                      u16TimeLock = 0;
  81   3                      IO_RED_LIGHT_ON;
  82   3                      lock = 0;
  83   3                }
  84   2              }
  85   1              else if((0X4000 == MyKey_Buf_Data)&&(0 == lock))
  86   1              {
  87   2                MyKey_Buf_Data = 0x1111;
  88   2                if(u16TimeLock < 1000)
  89   2                {
  90   3                   u16TimeLock++;
  91   3                }
  92   2                else
  93   2                {
  94   3                     u16TimeLock = 0;
  95   3                      IO_RED_LIGHT_OFF;
  96   3                      lock = 1;
  97   3                }
  98   2              }
  99   1      
 100   1      /***************************************************************/
 101   1             if(up_flag)
 102   1             {
 103   2                motro_count0++;
 104   2                if(motro_count0>1500)
 105   2                {
 106   3                   motro_count0 = 0;
 107   3                      up_flag = 0;
 108   3                      down_flag = 1;
 109   3                      P0 &= 0Xf9;
 110   3                }
 111   2             }
 112   1             if(down_flag)
 113   1             {
 114   2                motro_count1++;
 115   2                if(motro_count1>1500)
 116   2                {
C51 COMPILER V9.59.0.0   INIT                                                              04/27/2019 08:30:02 PAGE 3   

 117   3                  motro_count1 = 0;
 118   3                     up_flag = 1;
 119   3                     down_flag = 0;
 120   3                     P0 &= 0Xf9;
 121   3                }
 122   2             }
 123   1               if(auto_close_mass)
 124   1               {
 125   2                 if(auto_close_mass_cnt++ > auto_close_mass_time)//1800
 126   2                    {
 127   3                       auto_close_mass_cnt = 0;
 128   3                       auto_close_mass = 0;
 129   3                       //发送马达关闭指令
 130   3                       TX_DATA = 0x21;
 131   3      
 132   3                    }
 133   2               }
 134   1               if(auto_close_heat)
 135   1               {
 136   2                 if(auto_close_heat_cnt++ > auto_close_heat_time)//3600
 137   2                    {
 138   3                       auto_close_heat_cnt = 0;
 139   3                       auto_close_heat = 0;
 140   3                       //发送发热布关闭指令
 141   3                       IO_RED_LIGHT_OFF;
 142   3                       TX_DATA = 0x20;
 143   3                    }
 144   2               }
 145   1              #endif
 146   1      }
 147          
 148          #endif
 149          void Timer2Int(void) interrupt 5
 150          {             
 151   1             TF2 = 0;   //溢出清零
 152   1             
 153   1      }
 154          void timer1() interrupt 3
 155          {
 156   1             //P03 = ~P03;
 157   1      }
 158          
 159          
 160          
 161          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    440    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      5    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
