C51 COMPILER V9.59.0.0   INIT                                                              04/23/2019 19:04:06 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE INIT
OBJECT MODULE PLACED IN .\obj\INIT.obj
COMPILER INVOKED BY: E:\MDK\C51\BIN\C51.EXE C\INIT.C OPTIMIZE(2,SPEED) BROWSE INCDIR(.\H;.\lib) DEBUG OBJECTEXTEND PRINT
                    -(.\lst\INIT.lst) TABS(7) OBJECT(.\obj\INIT.obj)

line level    source

   1          #include "INIT.H"
   2          #include "SC92F836xB_C.H"
   3          #include "bsp_io_data.h"
   4          #include "TimeOut.h"
   5          
   6          unsigned char count_250us_time,count_level,lock = 1;
   7          unsigned int   count_1ms_time;
   8          extern unsigned int motro_count0,
   9                                      motro_count1,
  10                                      auto_close_heat_cnt,
  11                                      auto_close_mass_cnt,
  12                                      u16TimeLock;
  13          extern unsigned char TX_DATA;
  14          
  15          extern unsigned char up_flag,
  16                                        down_flag,
  17                                        auto_close_heat,
  18                                        auto_close_mass;
  19          
  20          extern unsigned long MyKey_Buf_Data;
  21          
  22          
  23          
  24          void GPIO_INIT(void)
  25          {
  26   1        P0CON |= 7 << 0;                    //设置P00,P01,P02为强推挽IO
  27   1        P2CON |= 1 << 5;                 //设置P25为强推挽IO
  28   1      
  29   1        IO_LED_FOOT_LIGHT_OFF;         //脚灯关闭
  30   1        IO_RED_LIGHT_OFF;           //红灯关闭
  31   1        IO_MOTOR_ONE_OFF;                 //升降马达1关闭
  32   1        IO_MOTOR_TWO_OFF;                 //升降马达2关闭
  33   1      }
  34          
  35          void Timer0_Init(void)
  36          { 
  37   1      
  38   1             TMCON = 0X07;    //------111 ;Timer0、Tiemr1和Tiemr2选择时钟Fsys
  39   1             
  40   1             //T0设置
  41   1             TMOD |= 0x01;                 //0000 0001;Timer0设置工作方式1
  42   1             TL0 = (65536 - 350)%256;    //溢出时间：时钟为Fsys，则24000*（1/Fsys）=2ms;
  43   1             TH0 = (65536 - 350)/256;
  44   1             TR0 = 0;
  45   1             ET0 = 1;//定时器0允许
  46   1             TR0 = 1;//打开定时器0
  47   1      }
  48          
  49          #if 1
  50          void timer0() interrupt 1         //2MS
  51          {
  52   1          TL0 = (65536 - 350)%256;     //1090      2080
  53   1          TH0 = (65536 - 350)/256;     //100us     2080
  54   1          #if 1
C51 COMPILER V9.59.0.0   INIT                                                              04/23/2019 19:04:06 PAGE 2   

  55   1          TimeOutDet_DecHandle();
  56   1              count_250us_time++;
  57   1              if(count_250us_time > 100)
  58   1              {
  59   2                count_250us_time = 0;
  60   2              }
  61   1              if(count_250us_time >= count_level)
  62   1              {
  63   2                IO_LED_FOOT_LIGHT_OFF;
  64   2              }
  65   1              else
  66   1              {
  67   2                IO_LED_FOOT_LIGHT_ON;
  68   2              }     
  69   1              /*****************************锁键定时器************************/
  70   1           if((0X4000 == MyKey_Buf_Data)&&(1 == lock))
  71   1              {
  72   2                MyKey_Buf_Data = 0x1111;
  73   2                if(u16TimeLock < 1000)
  74   2                {
  75   3                   u16TimeLock++;
  76   3                }
  77   2                else
  78   2                {
  79   3                      u16TimeLock = 0;
  80   3                      IO_RED_LIGHT_ON;
  81   3                      lock = 0;
  82   3                }
  83   2              }
  84   1              else if((0X4000 == MyKey_Buf_Data)&&(0 == lock))
  85   1              {
  86   2                MyKey_Buf_Data = 0x1111;
  87   2                if(u16TimeLock < 1000)
  88   2                {
  89   3                   u16TimeLock++;
  90   3                }
  91   2                else
  92   2                {
  93   3                     u16TimeLock = 0;
  94   3                      IO_RED_LIGHT_OFF;
  95   3                      lock = 1;
  96   3                }
  97   2              }
  98   1      
  99   1      /***************************************************************/
 100   1             if(up_flag)
 101   1             {
 102   2                motro_count0++;
 103   2                if(motro_count0>1500)
 104   2                {
 105   3                   motro_count0 = 0;
 106   3                      up_flag = 0;
 107   3                      down_flag = 1;
 108   3                      P0 &= 0Xf9;
 109   3                }
 110   2             }
 111   1             if(down_flag)
 112   1             {
 113   2                motro_count1++;
 114   2                if(motro_count1>1500)
 115   2                {
 116   3                  motro_count1 = 0;
C51 COMPILER V9.59.0.0   INIT                                                              04/23/2019 19:04:06 PAGE 3   

 117   3                     up_flag = 1;
 118   3                     down_flag = 0;
 119   3                     P0 &= 0Xf9;
 120   3                }
 121   2             }
 122   1               if(auto_close_mass)
 123   1               {
 124   2                 if(auto_close_mass_cnt++ > auto_close_mass_time)//1800
 125   2                    {
 126   3                       auto_close_mass_cnt = 0;
 127   3                       auto_close_mass = 0;
 128   3                       //发送马达关闭指令
 129   3                       TX_DATA = 0x21;
 130   3      
 131   3                    }
 132   2               }
 133   1               if(auto_close_heat)
 134   1               {
 135   2                 if(auto_close_heat_cnt++ > auto_close_heat_time)//3600
 136   2                    {
 137   3                       auto_close_heat_cnt = 0;
 138   3                       auto_close_heat = 0;
 139   3                       //发送发热布关闭指令
 140   3                       IO_RED_LIGHT_OFF;
 141   3                       TX_DATA = 0x20;
 142   3                    }
 143   2               }
 144   1              #endif
 145   1      }
 146          
 147          #endif
 148          void Timer2Int(void) interrupt 5
 149          {             
 150   1             TF2 = 0;   //溢出清零
 151   1             
 152   1      }
 153          void timer1() interrupt 3
 154          {
 155   1             //P03 = ~P03;
 156   1      }
 157          
 158          
 159          
 160          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    440    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      5    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
